---
// src/components/navbar/RecursiveMenu.astro
import type { NavigationItem } from "@lib/types/custom-page";

interface Props {
    items: NavigationItem[];
    isRoot?: boolean;
}

const { items, isRoot = false } = Astro.props;
// Import API_BASE_URL for image paths
import API_BASE_URL from "@api/base-url";
---

<ul
    class:list={[
        { menu: isRoot },
        "bg-base-100",
        { "w-full": isRoot },
        { "rounded-box": isRoot },
        { "border border-base-content/10": isRoot },
    ]}
>
    {
        items.map((item) => {
            const hasChildren = item.children && item.children.length > 0;
            // The `item.path` from backend NavigationItem is None for groups,
            // and a direct, correctly formatted path for pages.
            const path = item.path?.endsWith("/") ? item.path : item.path + "/";

            return (
                <li>
                    {hasChildren ? (
                        <details open={false}>
                            <summary>
                                {item.icon_type === 'image' && item.icon_image_path ? (
                                    <img 
                                        src={`${API_BASE_URL}/${item.icon_image_path}`} 
                                        alt={item.title} 
                                        class="w-5 h-5 object-contain inline-block mr-2" 
                                    />
                                ) : item.icon && (!item.icon_type || item.icon_type === 'fontawesome') ? (
                                    <i class={`fa-solid fa-${item.icon} `} />
                                ) : null}
                                {item.title}
                            </summary>
                            <Astro.self items={item.children} />
                        </details>
                    ) : path && item.path ? (
                        <a href={path}>
                            {item.icon_type === 'image' && item.icon_image_path ? (
                                <img 
                                    src={`${API_BASE_URL}/${item.icon_image_path}`} 
                                    alt={item.title} 
                                    class="w-5 h-5 object-contain inline-block mr-2" 
                                />
                            ) : item.icon && (!item.icon_type || item.icon_type === 'fontawesome') ? (
                                <i class={`fa-solid fa-${item.icon} `} />
                            ) : null}
                            {item.title}
                        </a>
                    ) : item.path === null ? (
                        <details open={false}>
                            <summary>
                                {item.icon_type === 'image' && item.icon_image_path ? (
                                    <img 
                                        src={`${API_BASE_URL}/${item.icon_image_path}`} 
                                        alt={item.title} 
                                        class="w-5 h-5 object-contain inline-block mr-2" 
                                    />
                                ) : item.icon && (!item.icon_type || item.icon_type === 'fontawesome') ? (
                                    <i class={`fa-solid fa-${item.icon} `} />
                                ) : null}
                                {item.title}
                            </summary>
                        </details>

                    ) : (
                        <span>
                            {item.icon_type === 'image' && item.icon_image_path ? (
                                <img 
                                    src={`${API_BASE_URL}/${item.icon_image_path}`} 
                                    alt={item.title} 
                                    class="w-5 h-5 object-contain inline-block mr-2" 
                                />
                            ) : item.icon && (!item.icon_type || item.icon_type === 'fontawesome') ? (
                                <i class={`fa-solid fa-${item.icon} `} />
                            ) : null}
                            {item.title} (Grupo sem link direto)
                        </span>
                    ) }
                </li>
            );
        })
    }
</ul>
